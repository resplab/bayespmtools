% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/valsamp.R
\name{bpm_valsamp}
\alias{bpm_valsamp}
\title{Bayesian Sample Size Calculator for External Validation}
\usage{
bpm_valsamp(
  evidence,
  targets,
  n_sim = NULL,
  method = "sample",
  threshold = NULL,
  dist_type = "logitnorm",
  impute_cor = TRUE,
  ex_args = NULL
)
}
\arguments{
\item{evidence}{A named list containing prior evidence components for model performance
parameters (e.g., prevalence, discrimination, calibration).
Alternatively, \code{evidence} may be a data frame of pre-posterior
draws (element \code{$sample}) returned by a previous call to this
function or to \code{bpm_valprec()}, in which case those draws are used
directly.}

\item{targets}{A named list specifying sample size targets.

Supported targets include:
\itemize{
\item Precision-based targets using expected 95\\% interval widths
(prefix \code{eciw}).
\item Assurance-based targets specifying the probability that the
95\\% interval width does not exceed a given value
(prefix \code{qciw}).
\item Net benefit targets, including optimality assurance
(\code{oa.nb}) and value-of-information ratios
(\code{voi.nb = EVSI / EVPI}).
}

For example, \code{eciw.cstat = 0.1} targets an expected interval width
of 0.1 for the c-statistic, while
\code{qciw.cal_slp = c(0.90, 0.22)} targets a 90 percent assurance that the
calibration slope interval width does not exceed 0.22.
Finally, \code{oa.nb = 0.80} targets a sample size that would correspond to
80 percent assurance that the strategy with the highest NB in the sample will
be the strategy with the highest NB in the  population.}

\item{n_sim}{Number of Monte Carlo simulations used to generate the pre-posterior
distribution. If evidence is a data frame from previous calls to relevant functions,
n_sim will automatically be set to the number of rows of the data frame.}

\item{method}{Method used to compute the pre-posterior distribution of 95\\% intervals.
One of \code{"sample"} (simulation-based) or \code{"2s"} (two-stage
approximation). Default is \code{"sample"}.}

\item{threshold}{Risk threshold used for decision-analytic quantities and net benefit
calculations. Required if \code{oa.nb} or \code{voi.nb} targets are
specified.}

\item{dist_type}{Distribution assumed for calibrated risks. Default is
\code{"logitnorm"}.}

\item{impute_cor}{Logical indicating whether correlation between performance measures
should be induced when simulating from marginal evidence distributions.
Default is \code{TRUE}.}

\item{ex_args}{Optional list of additional arguments passed to internal simulation or
root-finding routines (experimental feature).}
}
\value{
A list with the following components:
\itemize{
\item \code{results}: Estimated sample sizes required to meet each target.
\item \code{sample}: Data frame of pre-posterior simulation draws.
\item \code{evidence}: Processed evidence object used in the analysis.
\item \code{trace}: Trace output from the stochastic root-finding algorithm.
\item \code{targets}: The targets argument supplied to the function.
}
}
\description{
Bayesian sample size calculation for external validation studies of
clinical risk prediction models. The function evaluates sample sizes
required to meet precision-, assurance-, or decision-based targets
using pre-posterior simulation.
}
\examples{
\donttest{
evidence <- list(
 prev~beta(mean=0.428, sd=0.030),
 cstat~beta(mean=0.761, cih=0.773),
 cal_mean~norm(-0.009, 0.125),  #mean and SD
 cal_slp~norm(0.995, 0.024)     #mean and SD
)

targets <- list(
  eciw.cstat = 0.1,
  qciw.cstat = c(0.9, 0.1),
  oa.nb      = 0.8
)

samp <- bpm_valsamp(
  evidence  = evidence,
  targets   = targets,
  n_sim     = 1000,
  threshold = 0.2
)

samp$results
}

}
